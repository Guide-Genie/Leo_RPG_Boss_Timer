<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>Î†àÏò§ÏÑúÎ≤Ñ Î≥¥Ïä§ ÌÉÄÏù¥Î®∏</title>
  <style>
    body {
      background-color: #121212;
      color: #e0e0e0;
      font-family: 'Noto Sans KR', sans-serif;
      margin: 0;
      padding: 20px;
    }
    h1 {
      color: #ffffff;
      font-size: 2rem;
      text-align: center;
      margin-bottom: 5px;
    }
    .subtitle {
      color: #888;
      font-size: 0.9rem;
      text-align: center;
      margin-bottom: 20px;
    }
    .current-time {
      font-size: 1.8rem;
      text-align: center;
      margin-bottom: 30px;
    }
    .controls {
      display: flex;
      align-items: center;
      justify-content: center;
      margin-bottom: 20px;
      gap: 10px;
    }
    .controls input[type="range"] {
      width: 150px;
    }
    table {
      width: 90%;
      margin: auto;
      border-collapse: collapse;
    }
    th, td {
      border: 1px solid #444;
      padding: 10px;
      text-align: center;
    }
    th {
      background-color: #222;
      color: #ffcc00;
    }
    tr:nth-child(even) {
      background-color: #1a1a1a;
    }
    .highlight-warning {
      background-color: #333333 !important;
      color: #ffcc00 !important;
    }
    .highlight-active {
      background-color: #ffcc00 !important;
      color: #000 !important;
      font-weight: bold;
    }
  </style>
</head>
<body>
  <h1>Î†àÏò§ÏÑúÎ≤Ñ Î≥¥Ïä§ ÌÉÄÏù¥Î®∏</h1>
  <div class="subtitle">by W_Pl</div>
  <div class="current-time" id="currentTime"></div>
  <div class="controls">
    <label>üîä ÏïåÎûå Î≥ºÎ•®</label>
    <input type="range" min="0" max="1" step="0.01" id="volumeSlider">
    <button onclick="playTestSound()">Î≥ºÎ•® ÌÖåÏä§Ìä∏</button>
    <span>ÏùºÍ¥Ñ Ï†ÅÏö©/Ìï¥Ï†ú:</span>
    <button onclick="toggleAll(10)">10Î∂Ñ Ï†Ñ</button>
    <button onclick="toggleAll(5)">5Î∂Ñ Ï†Ñ</button>
    <button onclick="toggleAll(1)">1Î∂Ñ Ï†Ñ</button>
  </div>
  <table>
    <thead>
      <tr>
        <th>Î≥¥Ïä§Î™Ö</th>
        <th>ÏúÑÏπò</th>
        <th>Ï†† ÏãúÍ∞Ñ</th>
        <th>10Î∂Ñ Ï†Ñ</th>
        <th>5Î∂Ñ Ï†Ñ</th>
        <th>1Î∂Ñ Ï†Ñ</th>
      </tr>
    </thead>
    <tbody id="bossTable"></tbody>
  </table>

  <audio id="alarmSound">
    <source src="https://www.soundjay.com/button/beep-07.wav" type="audio/wav">
  </audio>

  <script>
    const alarmData = [
      { name: "Í∑∏Î£®Ìä∏ ÌÇπ", location: "1-5", timeText: "Îß§ Ïãú Ï†ïÍ∞Å", nextTime: t => new Date(t.getFullYear(), t.getMonth(), t.getDate(), t.getMinutes() < 60 ? t.getHours() + 1 : t.getHours(), 0) },
      { name: "Ìï¥Ï†Å ÏÑ†Ïû•", location: "2-5", timeText: "Îß§ Ïãú 30Î∂Ñ", nextTime: t => { const base = new Date(t); base.setMinutes(30, 0, 0); if (t.getMinutes() >= 30) base.setHours(base.getHours() + 1); return base; }},
      { name: "ÏïÑÏ†à Î∏åÎ£®Ìä∏", location: "3-5", timeText: "ÌôÄÏàò Ïãú 10Î∂Ñ", nextTime: t => { let h = t.getHours(); if (h % 2 === 0) h++; if (t.getHours() === h && t.getMinutes() >= 10) h += 2; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 10, 0, 0); }},
      { name: "ÏúÑÎçî", location: "4-5", timeText: "ÏßùÏàò Ïãú 10Î∂Ñ", nextTime: t => { let h = t.getHours(); if (h % 2 === 1) h++; if (t.getHours() === h && t.getMinutes() >= 10) h += 2; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 10, 0, 0); }},
      { name: "ÏøµÌë∏", location: "5-1", timeText: "ÌôÄÏàò Ïãú 40Î∂Ñ", nextTime: t => { let h = t.getHours(); if (h % 2 === 0) h++; if (t.getHours() === h && t.getMinutes() >= 40) h += 2; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 40, 0, 0); }},
      { name: "ÏÑúÎ¶¨Íµ∞Ï£º", location: "6-4", timeText: "ÏßùÏàò Ïãú 40Î∂Ñ", nextTime: t => { let h = t.getHours(); if (h % 2 === 1) h++; if (t.getHours() === h && t.getMinutes() >= 40) h += 2; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 40, 0, 0); }},
      { name: "ÌÉÄÎùΩÌïú Íµ∞Ï£º ÏÑ∏Î•¥Ïπ∏", location: "7-4", timeText: "ÌôÄÏàò Ïãú 50Î∂Ñ", nextTime: t => { let h = t.getHours(); if (h % 2 === 0) h++; if (t.getHours() === h && t.getMinutes() >= 50) h += 2; return new Date(t.getFullYear(), t.getMonth(), t.getDate(), h, 50, 0, 0); }}
    ];

    const alarmStates = JSON.parse(localStorage.getItem('alarmStates') || '{}');
    const lastTriggered = {};
    const highlightState = {};

    function saveState() {
      localStorage.setItem('alarmStates', JSON.stringify(alarmStates));
      localStorage.setItem('volume', document.getElementById('volumeSlider').value);
    }

    function createRow(boss) {
      const tr = document.createElement('tr');
      tr.id = `row-${boss.name}`;
      tr.innerHTML = `
        <td>${boss.name}</td>
        <td>${boss.location}</td>
        <td><div>${boss.timeText}</div><div id="remain-${boss.name}" style="font-size:0.85em;color:#aaa;"></div></td>
      `;
      [10, 5, 1].forEach(min => {
        const td = document.createElement('td');
        const input = document.createElement('input');
        input.type = 'checkbox';
        input.checked = alarmStates[boss.name + '_' + min] || false;
        input.addEventListener('change', () => {
          alarmStates[boss.name + '_' + min] = input.checked;
          saveState();
        });
        td.appendChild(input);
        tr.appendChild(td);
      });
      return tr;
    }

    function toggleAll(min) {
      alarmData.forEach(boss => {
        const key = boss.name + '_' + min;
        const newVal = !(alarmStates[key] || false);
        alarmStates[key] = newVal;
      });
      saveState();
      refreshTable();
    }

    function refreshTable() {
      const tableBody = document.getElementById('bossTable');
      tableBody.innerHTML = '';
      alarmData.forEach(boss => {
        const row = createRow(boss);
        tableBody.appendChild(row);
      });
    }

    function updateTime() {
      const now = new Date();
      document.getElementById('currentTime').innerText = now.toLocaleTimeString();

      alarmData.forEach(boss => {
        const row = document.getElementById(`row-${boss.name}`);
        [10, 5, 1].forEach(min => {
          if (!alarmStates[boss.name + '_' + min]) return;
          const nowTime = now.getTime();
          const targetTime = boss.nextTime(now).getTime();
          const alertTime = nowTime + min * 60000;
          if (Math.abs(targetTime - alertTime) < 1000) {
            triggerAlarm(boss.name, min);
            if (min === 1) {
              row.classList.add('highlight-warning');
              highlightState[boss.name] = { start: Date.now(), stage: 'warning' };
            }
          }
        });

        if (highlightState[boss.name]) {
          const state = highlightState[boss.name];
          const elapsed = (Date.now() - state.start) / 1000;

          if (state.stage === 'warning' && elapsed >= 60) {
            row.classList.remove('highlight-warning');
            row.classList.add('highlight-active');
            highlightState[boss.name] = { start: Date.now(), stage: 'active' };
          } else if (state.stage === 'active' && elapsed >= 30) {
            row.classList.remove('highlight-active');
            delete highlightState[boss.name];
          }
        }

        const remain = boss.nextTime(now).getTime() - now.getTime();
        if (remain >= 0) {
          const h = Math.floor(remain / 3600000);
          const m = Math.floor((remain % 3600000) / 60000);
          const s = Math.floor((remain % 60000) / 1000);
          const remainText = `${h.toString().padStart(2, '0')}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
          const remainEl = document.getElementById(`remain-${boss.name}`);
          if (remainEl) remainEl.textContent = `(ÎÇ®ÏùÄ ÏãúÍ∞Ñ: ${remainText})`;
        }
      });
    }

    function triggerAlarm(name, min) {
      const key = name + '_' + min;
      const nowMin = new Date().getMinutes();
      if (lastTriggered[key] === nowMin) return;
      lastTriggered[key] = nowMin;
      let count = 0;
      const alarm = document.getElementById('alarmSound');
      alarm.volume = parseFloat(document.getElementById('volumeSlider').value || 0.5);
      const interval = setInterval(() => {
        alarm.currentTime = 0;
        alarm.play();
        if (++count >= 9) clearInterval(interval);
      }, 500);
    }

    function playTestSound() {
      const alarm = document.getElementById('alarmSound');
      alarm.volume = parseFloat(document.getElementById('volumeSlider').value || 0.5);
      alarm.currentTime = 0;
      alarm.play();
    }

    document.getElementById('volumeSlider').value = localStorage.getItem('volume') || 0.5;
    document.getElementById('volumeSlider').addEventListener('input', saveState);

    refreshTable();
    setInterval(updateTime, 1000);
  </script>
</body>
</html>
